<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialBook - Connect with the World</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom Scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animation for like button */
        @keyframes like-bounce {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .animate-like {
            animation: like-bounce 0.3s ease-in-out;
        }
    </style>
</head>

<body class="bg-[#F0F2F5] text-gray-800 font-sans overflow-hidden">

    <!-- App Container -->
    <div id="app" class="h-screen flex flex-col">
        <!-- Loading Screen -->
        <div id="loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
            <div class="text-blue-600 text-5xl mb-4"><i class="fab fa-facebook"></i></div>
            <div class="text-gray-500 font-medium">Generating 1000 Users & Connections...</div>
            <div class="w-64 h-2 bg-gray-200 rounded-full mt-4 overflow-hidden">
                <div id="loading-bar" class="h-full bg-blue-600 w-0 transition-all duration-300"></div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav class="bg-white shadow-sm px-4 h-14 flex items-center justify-between z-40 fixed w-full top-0">
            <!-- Logo & Search -->
            <div class="flex items-center gap-2 md:gap-4 w-1/3">
                <div class="text-blue-600 text-4xl cursor-pointer" onclick="app.navigate('home')">
                    <i class="fab fa-facebook"></i>
                </div>
                <div class="relative w-full max-w-[240px] hidden md:block">
                    <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                    <input type="text" id="global-search" placeholder="Search SocialBook"
                        class="bg-[#F0F2F5] rounded-full pl-10 pr-4 py-2 w-full focus:outline-none focus:ring-1 focus:ring-blue-500 transition-all">
                    <!-- Search Results Dropdown -->
                    <div id="search-results"
                        class="hidden absolute top-12 left-0 w-full bg-white shadow-xl rounded-lg p-2 max-h-96 overflow-y-auto z-50">
                    </div>
                </div>
                <div
                    class="md:hidden w-10 h-10 bg-[#F0F2F5] rounded-full flex items-center justify-center text-gray-600">
                    <i class="fas fa-search"></i>
                </div>
            </div>

            <!-- Center Nav Icons (Desktop) -->
            <div class="hidden md:flex justify-center w-1/3 gap-10 h-full">
                <button onclick="app.navigate('home')"
                    class="nav-btn h-full px-10 border-b-4 border-blue-600 text-blue-600 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-home text-xl"></i>
                </button>
                <button
                    class="nav-btn h-full px-10 border-b-4 border-transparent text-gray-500 hover:bg-gray-100 hover:border-b-4 transition-colors relative">
                    <i class="fas fa-user-friends text-xl"></i>
                    <span
                        class="absolute top-3 right-8 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full">3</span>
                </button>
                <button
                    class="nav-btn h-full px-10 border-b-4 border-transparent text-gray-500 hover:bg-gray-100 hover:border-b-4 transition-colors">
                    <i class="fas fa-store text-xl"></i>
                </button>
                <button
                    class="nav-btn h-full px-10 border-b-4 border-transparent text-gray-500 hover:bg-gray-100 hover:border-b-4 transition-colors">
                    <i class="fas fa-users text-xl"></i>
                </button>
            </div>

            <!-- Right Profile & Menu -->
            <div class="flex items-center justify-end gap-2 md:gap-3 w-1/3">
                <button
                    class="w-10 h-10 bg-[#E4E6EB] rounded-full flex items-center justify-center hover:bg-[#D8DADF] transition-colors hidden md:flex">
                    <i class="fas fa-th text-black"></i>
                </button>
                <button
                    class="w-10 h-10 bg-[#E4E6EB] rounded-full flex items-center justify-center hover:bg-[#D8DADF] transition-colors relative">
                    <i class="fab fa-facebook-messenger text-black"></i>
                    <span
                        class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full border-2 border-white">5</span>
                </button>
                <button
                    class="w-10 h-10 bg-[#E4E6EB] rounded-full flex items-center justify-center hover:bg-[#D8DADF] transition-colors relative">
                    <i class="fas fa-bell text-black"></i>
                    <span
                        class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full border-2 border-white">9+</span>
                </button>
                <div class="relative group">
                    <img id="current-user-avatar" src="" alt="Profile"
                        class="w-10 h-10 rounded-full cursor-pointer object-cover border border-gray-200">
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <div class="flex flex-1 mt-14 overflow-hidden relative">

            <!-- Left Sidebar (Shortcuts) - Hidden on Mobile -->
            <aside
                class="hidden xl:block w-[360px] p-4 overflow-y-auto hover:overflow-y-scroll hide-scrollbar h-full sticky top-14">
                <div onclick="app.navigateToProfile(app.state.currentUser.id)"
                    class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors mb-2">
                    <img id="sidebar-user-avatar" src="" class="w-9 h-9 rounded-full object-cover">
                    <span id="sidebar-user-name" class="font-medium"></span>
                </div>

                <div class="space-y-1 border-b border-gray-300 pb-4 mb-4">
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <i class="fas fa-user-friends text-blue-500 text-xl w-8 text-center"></i>
                        <span class="font-medium">Friends</span>
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <i class="fas fa-clock text-blue-400 text-xl w-8 text-center"></i>
                        <span class="font-medium">Memories</span>
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <i class="fas fa-bookmark text-purple-500 text-xl w-8 text-center"></i>
                        <span class="font-medium">Saved</span>
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <i class="fas fa-users text-blue-400 text-xl w-8 text-center"></i>
                        <span class="font-medium">Groups</span>
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <i class="fas fa-video text-blue-500 text-xl w-8 text-center"></i>
                        <span class="font-medium">Video</span>
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <i class="fas fa-store text-blue-500 text-xl w-8 text-center"></i>
                        <span class="font-medium">Marketplace</span>
                    </a>
                </div>

                <div class="font-semibold text-gray-500 mb-2 px-2">Your Shortcuts</div>
                <div class="space-y-1">
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <img src="https://picsum.photos/seed/game/40/40" class="w-9 h-9 rounded-lg">
                        <span class="font-medium">8 Ball Pool</span>
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors">
                        <img src="https://picsum.photos/seed/code/40/40" class="w-9 h-9 rounded-lg">
                        <span class="font-medium">Web Developers Group</span>
                    </a>
                </div>
            </aside>

            <!-- Main Feed / Content -->
            <main id="main-view" class="flex-1 flex justify-center overflow-y-auto bg-[#F0F2F5] pb-10">
                <div class="w-full max-w-[680px] px-0 md:px-4 py-6">

                    <!-- Stories -->
                    <div id="stories-container"
                        class="relative h-[200px] mb-6 flex gap-2 overflow-x-auto hide-scrollbar snap-x">
                        <!-- Story Card (Create) -->
                        <div
                            class="min-w-[140px] h-full bg-white rounded-xl shadow-sm overflow-hidden relative cursor-pointer group flex-shrink-0 snap-start">
                            <img id="story-user-img"
                                class="w-full h-[70%] object-cover transition-transform duration-300 group-hover:scale-105"
                                src="">
                            <div
                                class="absolute bottom-0 w-full h-[30%] bg-white flex flex-col items-center justify-end pb-2">
                                <div
                                    class="w-10 h-10 bg-blue-600 rounded-full border-4 border-white flex items-center justify-center absolute -top-5 text-white">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <span class="text-xs font-semibold">Create story</span>
                            </div>
                        </div>
                        <!-- Dynamic Stories injected via JS -->
                    </div>

                    <!-- Create Post -->
                    <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                        <div class="flex gap-3 mb-4">
                            <img id="create-post-avatar" src="" class="w-10 h-10 rounded-full object-cover">
                            <div
                                class="flex-1 bg-[#F0F2F5] hover:bg-[#E4E6EB] rounded-full px-4 flex items-center cursor-pointer transition-colors">
                                <span class="text-gray-500">What's on your mind?</span>
                            </div>
                        </div>
                        <div class="border-t pt-3 flex justify-between">
                            <button
                                class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg transition-colors">
                                <i class="fas fa-video text-red-500"></i>
                                <span class="font-medium text-gray-600 text-sm sm:text-base">Live Video</span>
                            </button>
                            <button
                                class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg transition-colors">
                                <i class="fas fa-images text-green-500"></i>
                                <span class="font-medium text-gray-600 text-sm sm:text-base">Photo/Video</span>
                            </button>
                            <button
                                class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg transition-colors">
                                <i class="fas fa-laugh-beam text-yellow-500"></i>
                                <span class="font-medium text-gray-600 text-sm sm:text-base">Feeling/Activity</span>
                            </button>
                        </div>
                    </div>

                    <!-- Feed Container -->
                    <div id="feed-container" class="space-y-4"></div>
                </div>
            </main>

            <!-- Profile View (Hidden by default) -->
            <main id="profile-view" class="flex-1 overflow-y-auto bg-[#F0F2F5] hidden">
                <div class="bg-white shadow-sm pb-4">
                    <div class="max-w-[1095px] mx-auto relative">
                        <!-- Cover Photo -->
                        <div id="profile-cover"
                            class="h-[200px] md:h-[350px] w-full bg-gradient-to-r from-blue-400 to-purple-500 rounded-b-lg relative overflow-hidden">
                            <button
                                class="absolute bottom-4 right-4 bg-white text-black px-3 py-1.5 rounded-md font-semibold text-sm shadow-md hover:bg-gray-100 flex items-center gap-2">
                                <i class="fas fa-camera"></i> <span class="hidden sm:inline">Edit Cover Photo</span>
                            </button>
                        </div>

                        <!-- Profile Info Area -->
                        <div
                            class="px-4 md:px-8 pb-4 relative flex flex-col md:flex-row items-center md:items-end -mt-[84px] md:-mt-[30px] mb-4">
                            <!-- Avatar -->
                            <div class="relative p-1 bg-white rounded-full">
                                <img id="profile-avatar-large" src=""
                                    class="w-[168px] h-[168px] rounded-full object-cover border-4 border-white">
                                <div
                                    class="absolute bottom-4 right-4 bg-gray-200 w-9 h-9 rounded-full flex items-center justify-center cursor-pointer border-2 border-white">
                                    <i class="fas fa-camera text-black"></i>
                                </div>
                            </div>

                            <!-- Name & Friends -->
                            <div class="flex-1 md:ml-6 text-center md:text-left mt-2 md:mt-0 md:mb-4">
                                <h1 id="profile-name" class="text-3xl font-bold text-gray-900"></h1>
                                <p id="profile-friends-count" class="text-gray-500 font-semibold mt-1"></p>
                                <div id="profile-friends-preview"
                                    class="flex justify-center md:justify-start -space-x-2 mt-2"></div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex gap-2 mt-4 md:mb-6">
                                <button id="btn-add-friend"
                                    class="bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2">
                                    <i class="fas fa-user-plus"></i> <span>Add Friend</span>
                                </button>
                                <button
                                    class="bg-[#E4E6EB] text-black px-4 py-2 rounded-md font-semibold hover:bg-[#D8DADF] transition-colors flex items-center gap-2">
                                    <i class="fab fa-facebook-messenger"></i> <span>Message</span>
                                </button>
                            </div>
                        </div>

                        <!-- Profile Tabs -->
                        <div class="border-t px-4 md:px-8">
                            <div class="flex gap-1 pt-1">
                                <button
                                    class="px-4 py-3 font-semibold text-blue-600 border-b-[3px] border-blue-600">Posts</button>
                                <button
                                    class="px-4 py-3 font-semibold text-gray-600 hover:bg-gray-100 rounded-lg">About</button>
                                <button
                                    class="px-4 py-3 font-semibold text-gray-600 hover:bg-gray-100 rounded-lg">Friends</button>
                                <button
                                    class="px-4 py-3 font-semibold text-gray-600 hover:bg-gray-100 rounded-lg">Photos</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Content Grid -->
                <div class="max-w-[1095px] mx-auto px-4 py-6 flex flex-col md:flex-row gap-4">
                    <!-- Left Column: Intro & Photos -->
                    <div class="w-full md:w-[40%] space-y-4">
                        <!-- Intro -->
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            <h2 class="text-xl font-bold mb-3">Intro</h2>
                            <p id="profile-bio" class="text-center text-sm text-gray-600 mb-4 pb-4 border-b"></p>

                            <div class="space-y-3">
                                <div class="flex items-center gap-3 text-gray-700">
                                    <i class="fas fa-briefcase text-gray-400 w-5"></i>
                                    <span>Works at <strong id="profile-work"></strong></span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-700">
                                    <i class="fas fa-graduation-cap text-gray-400 w-5"></i>
                                    <span>Studied at <strong id="profile-school"></strong></span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-700">
                                    <i class="fas fa-home text-gray-400 w-5"></i>
                                    <span>Lives in <strong id="profile-city"></strong></span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-700">
                                    <i class="fas fa-map-marker-alt text-gray-400 w-5"></i>
                                    <span>From <strong id="profile-from"></strong></span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-700">
                                    <i class="fas fa-heart text-gray-400 w-5"></i>
                                    <span id="profile-relationship"></span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-700">
                                    <i class="fas fa-phone text-gray-400 w-5"></i>
                                    <span id="profile-phone"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Photos -->
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            <div class="flex justify-between items-center mb-3">
                                <h2 class="text-xl font-bold">Photos</h2>
                                <a href="#" class="text-blue-600 hover:underline text-sm">See All Photos</a>
                            </div>
                            <div class="grid grid-cols-3 gap-1 rounded-lg overflow-hidden">
                                <img src="https://picsum.photos/seed/p1/200"
                                    class="w-full h-24 object-cover cursor-pointer hover:opacity-90">
                                <img src="https://picsum.photos/seed/p2/200"
                                    class="w-full h-24 object-cover cursor-pointer hover:opacity-90">
                                <img src="https://picsum.photos/seed/p3/200"
                                    class="w-full h-24 object-cover cursor-pointer hover:opacity-90">
                                <img src="https://picsum.photos/seed/p4/200"
                                    class="w-full h-24 object-cover cursor-pointer hover:opacity-90">
                                <img src="https://picsum.photos/seed/p5/200"
                                    class="w-full h-24 object-cover cursor-pointer hover:opacity-90">
                                <img src="https://picsum.photos/seed/p6/200"
                                    class="w-full h-24 object-cover cursor-pointer hover:opacity-90">
                            </div>
                        </div>

                        <!-- Friends Grid -->
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <h2 class="text-xl font-bold">Friends</h2>
                                    <p id="profile-friends-subtext" class="text-gray-500 text-sm"></p>
                                </div>
                                <a href="#" class="text-blue-600 hover:underline text-sm">See All Friends</a>
                            </div>
                            <div id="friends-grid" class="grid grid-cols-3 gap-2">
                                <!-- Populated via JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Posts -->
                    <div class="w-full md:w-[60%]">
                        <!-- Create Post (Profile Context) -->
                        <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                            <div class="flex gap-3 mb-4">
                                <img id="profile-post-avatar" src="" class="w-10 h-10 rounded-full object-cover">
                                <div
                                    class="flex-1 bg-[#F0F2F5] hover:bg-[#E4E6EB] rounded-full px-4 flex items-center cursor-pointer transition-colors">
                                    <span class="text-gray-500">Write something to...</span>
                                </div>
                            </div>
                            <div class="border-t pt-3 flex justify-between">
                                <button
                                    class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg transition-colors">
                                    <i class="fas fa-video text-red-500"></i>
                                    <span class="font-medium text-gray-600 text-sm">Live Video</span>
                                </button>
                                <button
                                    class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg transition-colors">
                                    <i class="fas fa-images text-green-500"></i>
                                    <span class="font-medium text-gray-600 text-sm">Photo/Video</span>
                                </button>
                            </div>
                        </div>

                        <div id="profile-feed-container" class="space-y-4"></div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar (Contacts) - Hidden on smaller screens -->
            <aside class="hidden xl:flex w-[360px] flex-col p-2 h-full sticky top-14">
                <div class="flex items-center justify-between text-gray-500 font-semibold mb-2 px-2">
                    <span>Contacts</span>
                    <div class="flex gap-3">
                        <i class="fas fa-video hover:bg-gray-200 p-2 rounded-full cursor-pointer"></i>
                        <i class="fas fa-search hover:bg-gray-200 p-2 rounded-full cursor-pointer"></i>
                        <i class="fas fa-ellipsis-h hover:bg-gray-200 p-2 rounded-full cursor-pointer"></i>
                    </div>
                </div>
                <div id="contacts-list" class="overflow-y-auto hover:overflow-y-scroll hide-scrollbar flex-1 space-y-1">
                    <!-- Populated via JS -->
                </div>
            </aside>

        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"
        class="fixed bottom-5 left-5 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 transition-transform duration-300 z-50 flex items-center gap-3">
        <i class="fas fa-check-circle text-green-400"></i>
        <span id="toast-msg">Notification</span>
    </div>

    <!-- JavaScript Logic -->
    <script>
        /**
         * SocialBook App Logic
         * 1. Data Generation: Creates 1000 users with varied attributes.
         * 2. State Management: Handles navigation, current user, and posts.
         * 3. DOM Rendering: Efficiently updates the UI.
         */

        // --- Seeded Random Generator (Mulberry32) ---
        // This ensures every refresh generates the exact same dataset
        function mulberry32(a) {
            return function () {
                var t = a += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }
        // Changing this seed value will generate a completely NEW set of consistent users
        const SEED = 8888;
        const random = mulberry32(SEED);

        const CONSTANTS = {
            FIRST_NAMES: ["James", "Mary", "Robert", "Patricia", "John", "Jennifer", "Michael", "Linda", "David", "Elizabeth", "William", "Barbara", "Richard", "Susan", "Joseph", "Jessica", "Thomas", "Sarah", "Charles", "Karen", "Christopher", "Nancy", "Daniel", "Lisa", "Matthew", "Margaret", "Anthony", "Betty", "Mark", "Sandra", "Donald", "Ashley", "Steven", "Kimberly", "Paul", "Emily", "Andrew", "Donna", "Joshua", "Michelle", "Kenneth", "Dorothy", "Kevin", "Carol", "Brian", "Amanda", "George", "Melissa", "Edward", "Deborah"],
            LAST_NAMES: ["Smith", "Johnson", "Williams", "Brown", "Jones", "Garcia", "Miller", "Davis", "Rodriguez", "Martinez", "Hernandez", "Lopez", "Gonzalez", "Wilson", "Anderson", "Thomas", "Taylor", "Moore", "Jackson", "Martin", "Lee", "Perez", "Thompson", "White", "Harris", "Sanchez", "Clark", "Ramirez", "Lewis", "Robinson", "Walker", "Young", "Allen", "King", "Wright", "Scott", "Torres", "Nguyen", "Hill", "Flores", "Green", "Adams", "Nelson", "Baker", "Hall", "Rivera", "Campbell", "Mitchell", "Carter", "Roberts"],
            CITIES: ["New York, NY", "Los Angeles, CA", "Chicago, IL", "Houston, TX", "Phoenix, AZ", "Philadelphia, PA", "San Antonio, TX", "San Diego, CA", "Dallas, TX", "San Jose, CA", "Austin, TX", "Jacksonville, FL", "Fort Worth, TX", "Columbus, OH", "San Francisco, CA", "Charlotte, NC", "Indianapolis, IN", "Seattle, WA", "Denver, CO", "Washington, DC"],
            COMPANIES: ["Google", "Meta", "Amazon", "Apple", "Microsoft", "Tesla", "Netflix", "Spotify", "Adobe", "Salesforce", "Oracle", "IBM", "Intel", "Cisco", "Uber", "Airbnb", "Twitter", "Snapchat", "TikTok", "Zoom", "Slack", "Stripe", "SpaceX", "NASA", "Goldman Sachs", "JP Morgan", "Morgan Stanley", "Deloitte", "Accenture", "McKinsey", "Starbucks", "Walmart", "Target", "Costco", "Nike", "Adidas", "Coca-Cola", "PepsiCo", "McDonald's", "Disney"],
            SCHOOLS: ["Harvard University", "Stanford University", "MIT", "UC Berkeley", "UCLA", "Yale University", "Princeton University", "Columbia University", "University of Michigan", "UT Austin", "NYU", "Cornell University", "University of Pennsylvania", "University of Chicago", "Duke University", "Northwestern University", "Johns Hopkins University", "Caltech", "University of Washington", "Georgia Tech"],
            RELATIONSHIPS: ["Single", "In a relationship", "Engaged", "Married", "It's complicated", "Separated", "Divorced", "Widowed"],
            BIOS: [
                "Living life one day at a time.", "Tech enthusiast and coffee lover.", "Just here for the memes.", "Dreamer. Believer. Achiever.", "Wanderlust infected.", "Professional procrastination practitioner.", "Making history.", "Creating my own sunshine.", "Simplicity is the key to happiness.", "Digital Nomad."
            ],
            POST_CONTENTS: [
                "Just had the best coffee ever! â˜•ï¸ #CoffeeLover",
                "Working hard or hardly working? ðŸ¤” #OfficeLife",
                "Can't believe it's already Friday! ðŸŽ‰ #WeekendVibes",
                "Check out this amazing view! ðŸŒ„ #Nature",
                "Anyone know a good place for sushi around here? ðŸ£",
                "Just finished reading a great book. Highly recommend! ðŸ“š",
                "So excited for the upcoming trip! âœˆï¸ #Travel",
                "Learning to code is tough but rewarding. ðŸ’» #Coding",
                "Happy birthday to my best friend! ðŸŽ‚",
                "Life is beautiful. â¤ï¸"
            ]
        };

        // --- Data Generation ---

        const generateRandomInt = (min, max) => Math.floor(random() * (max - min + 1)) + min;
        const pickRandom = (arr) => arr[Math.floor(random() * arr.length)];

        class User {
            constructor(id) {
                this.id = id;
                this.firstName = pickRandom(CONSTANTS.FIRST_NAMES);
                this.lastName = pickRandom(CONSTANTS.LAST_NAMES);
                this.fullName = `${this.firstName} ${this.lastName}`;
                // Using UI Avatars for deterministic but varied avatars
                this.avatar = `https://ui-avatars.com/api/?name=${this.firstName}+${this.lastName}&background=random&color=fff&size=200`;
                this.coverPhoto = `https://picsum.photos/seed/${id}/1200/400`; // Random consistent seed

                this.work = pickRandom(CONSTANTS.COMPANIES);
                this.school = pickRandom(CONSTANTS.SCHOOLS);
                this.city = pickRandom(CONSTANTS.CITIES);
                this.from = pickRandom(CONSTANTS.CITIES);
                this.relationship = pickRandom(CONSTANTS.RELATIONSHIPS);
                this.phone = `(${generateRandomInt(100, 999)}) ${generateRandomInt(100, 999)}-${generateRandomInt(1000, 9999)}`;
                this.bio = pickRandom(CONSTANTS.BIOS);

                this.friendIds = []; // Filled later
                this.posts = [];
            }
        }

        class App {
            constructor() {
                this.users = [];
                this.userMap = new Map();
                this.currentUser = null;
                this.state = {
                    view: 'home',
                    profileId: null,
                    posts: []
                };
            }

            async loadCustomUsers() {
                const res = await fetch('custom_users.json');
                if (!res.ok) return;
                const extras = await res.json();
                extras.forEach((c, idx) => {
                    const user = new User(1000 + idx);
                    Object.assign(user, c, { fullName: `${c.firstName} ${c.lastName}` });
                    this.users.push(user);
                    this.userMap.set(user.id, user);
                });
            }

            async init() {
                this.updateLoadingBar(10);

                // 1. Generate 1000 Users
                await this.processInChunks(1000, (i) => {
                    const user = new User(i);
                    this.users.push(user);
                    this.userMap.set(user.id, user);
                });

                this.updateLoadingBar(60);

                await this.loadCustomUsers();

                // 2. Generate Friendships (Random Graph)
                // Each user gets between 5 and 50 friends randomly
                await this.processInChunks(1000, (i) => {
                    const user = this.users[i];
                    const friendCount = generateRandomInt(5, 50);
                    for (let j = 0; j < friendCount; j++) {
                        const randomFriendId = generateRandomInt(0, 999);
                        if (randomFriendId !== user.id && !user.friendIds.includes(randomFriendId)) {
                            user.friendIds.push(randomFriendId);
                            // Bidirectional
                            const friend = this.userMap.get(randomFriendId);
                            if (friend && !friend.friendIds.includes(user.id)) {
                                friend.friendIds.push(user.id);
                            }
                        }
                    }
                });

                this.updateLoadingBar(80);

                // 3. Generate Posts
                // Generate a global feed of posts from random users
                for (let i = 0; i < 300; i++) {
                    this.state.posts.push(this.createRandomPost());
                }

                this.updateLoadingBar(100);

                // 4. Set Current User (User 0 usually)
                this.currentUser = this.users[0];
                this.state.profileId = this.currentUser.id;

                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    this.renderApp();
                }, 500);
            }

            // Helper to prevent freezing UI during heavy generation
            processInChunks(total, processFn) {
                return new Promise(resolve => {
                    let i = 0;
                    const chunk = 50;
                    const doChunk = () => {
                        let count = 0;
                        while (i < total && count < chunk) {
                            processFn(i);
                            i++;
                            count++;
                        }
                        if (i < total) {
                            setTimeout(doChunk, 0);
                        } else {
                            resolve();
                        }
                    };
                    doChunk();
                });
            }

            updateLoadingBar(percent) {
                document.getElementById('loading-bar').style.width = `${percent}%`;
            }

            createRandomPost() {
                const authorId = generateRandomInt(0, 999);
                const author = this.userMap.get(authorId);
                const hasImage = random() > 0.6;
                return {
                    id: random().toString(36).substr(2, 9),
                    authorId: authorId,
                    content: pickRandom(CONSTANTS.POST_CONTENTS),
                    image: hasImage ? `https://picsum.photos/seed/${Math.floor(random() * 10000)}/600/400` : null,
                    timestamp: generateRandomInt(1, 23) + 'h',
                    likes: generateRandomInt(0, 500),
                    comments: generateRandomInt(0, 50),
                    shares: generateRandomInt(0, 20),
                    isLiked: false
                };
            }

            // --- Rendering ---

            renderApp() {
                this.renderNavbar();
                this.renderSidebar();
                this.renderStories();

                if (this.state.view === 'home') {
                    document.getElementById('main-view').classList.remove('hidden');
                    document.getElementById('profile-view').classList.add('hidden');
                    this.renderFeed(this.state.posts, 'feed-container');
                } else if (this.state.view === 'profile') {
                    document.getElementById('main-view').classList.add('hidden');
                    document.getElementById('profile-view').classList.remove('hidden');
                    this.renderProfile();
                }
            }

            renderNavbar() {
                document.getElementById('current-user-avatar').src = this.currentUser.avatar;

                // Search Logic
                const searchInput = document.getElementById('global-search');
                const searchResults = document.getElementById('search-results');

                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    if (query.length < 2) {
                        searchResults.classList.add('hidden');
                        return;
                    }

                    const matches = this.users.filter(u => u.fullName.toLowerCase().includes(query)).slice(0, 8);

                    searchResults.innerHTML = '';
                    if (matches.length > 0) {
                        searchResults.classList.remove('hidden');
                        matches.forEach(u => {
                            const div = document.createElement('div');
                            div.className = "flex items-center gap-3 p-2 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors";
                            div.innerHTML = `
                                <img src="${u.avatar}" class="w-9 h-9 rounded-full object-cover">
                                <span class="font-medium text-sm">${u.fullName}</span>
                            `;
                            div.onclick = () => {
                                searchInput.value = '';
                                searchResults.classList.add('hidden');
                                this.navigateToProfile(u.id);
                            };
                            searchResults.appendChild(div);
                        });
                    } else {
                        searchResults.innerHTML = '<div class="p-2 text-gray-500 text-sm text-center">No results found</div>';
                        searchResults.classList.remove('hidden');
                    }
                });

                // Click outside to close
                document.addEventListener('click', (e) => {
                    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                        searchResults.classList.add('hidden');
                    }
                });
            }

            renderSidebar() {
                document.getElementById('sidebar-user-avatar').src = this.currentUser.avatar;
                document.getElementById('sidebar-user-name').innerText = this.currentUser.fullName;
                document.getElementById('create-post-avatar').src = this.currentUser.avatar;
                document.getElementById('story-user-img').src = this.currentUser.avatar;

                // Render Contacts (Friends of current user)
                const contactsList = document.getElementById('contacts-list');
                contactsList.innerHTML = '';
                // Limit to 20 for performance in sidebar
                const friends = this.currentUser.friendIds.slice(0, 20).map(id => this.userMap.get(id));

                friends.forEach(f => {
                    const div = document.createElement('div');
                    div.className = "flex items-center gap-3 p-2 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors group";
                    div.onclick = () => this.navigateToProfile(f.id);
                    div.innerHTML = `
                        <div class="relative">
                            <img src="${f.avatar}" class="w-9 h-9 rounded-full object-cover">
                            <span class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></span>
                        </div>
                        <span class="font-medium text-sm truncate">${f.fullName}</span>
                    `;
                    contactsList.appendChild(div);
                });
            }

            renderStories() {
                const container = document.getElementById('stories-container');
                // Keep the "Create Story" card, remove others
                while (container.children.length > 1) {
                    container.removeChild(container.lastChild);
                }

                // Generate fake stories
                for (let i = 0; i < 10; i++) {
                    const u = this.userMap.get(generateRandomInt(0, 999));
                    const div = document.createElement('div');
                    div.className = "min-w-[140px] h-full bg-gray-800 rounded-xl overflow-hidden relative cursor-pointer group flex-shrink-0 snap-start transition-all hover:opacity-95";
                    div.innerHTML = `
                        <img src="https://picsum.photos/seed/story${i}/200/300" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 opacity-80">
                        <div class="absolute top-4 left-4 w-10 h-10 rounded-full border-4 border-blue-600 overflow-hidden z-10">
                             <img src="${u.avatar}" class="w-full h-full object-cover">
                        </div>
                        <span class="absolute bottom-3 left-3 text-white font-semibold text-sm drop-shadow-md z-10">${u.firstName} ${u.lastName[0]}.</span>
                    `;
                    container.appendChild(div);
                }
            }

            renderFeed(posts, containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';

                posts.forEach(post => {
                    const author = this.userMap.get(post.authorId);
                    if (!author) return;

                    const el = document.createElement('div');
                    el.className = "bg-white rounded-lg shadow-sm mb-4";
                    el.innerHTML = `
                        <!-- Header -->
                        <div class="p-4 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <img src="${author.avatar}" class="w-10 h-10 rounded-full object-cover cursor-pointer" onclick="app.navigateToProfile(${author.id})">
                                <div>
                                    <div class="font-semibold text-gray-900 cursor-pointer hover:underline" onclick="app.navigateToProfile(${author.id})">${author.fullName}</div>
                                    <div class="text-xs text-gray-500 flex items-center gap-1">
                                        ${post.timestamp} &middot; <i class="fas fa-globe-americas"></i>
                                    </div>
                                </div>
                            </div>
                            <button class="text-gray-500 hover:bg-gray-100 w-8 h-8 rounded-full"><i class="fas fa-ellipsis-h"></i></button>
                        </div>
                        
                        <!-- Content -->
                        <div class="px-4 pb-2 text-sm md:text-base text-gray-800">${post.content}</div>
                        ${post.image ? `<div class="mt-2"><img src="${post.image}" class="w-full h-auto object-cover max-h-[500px]"></div>` : ''}
                        
                        <!-- Stats -->
                        <div class="px-4 py-2 flex items-center justify-between text-gray-500 text-sm border-b mx-4 border-gray-100">
                            <div class="flex items-center gap-1">
                                <div class="bg-blue-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-[10px]"><i class="fas fa-thumbs-up"></i></div>
                                <span id="likes-count-${post.id}">${post.likes}</span>
                            </div>
                            <div class="flex gap-3">
                                <span>${post.comments} comments</span>
                                <span>${post.shares} shares</span>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="px-2 py-1 flex justify-between mx-2">
                            <button id="like-btn-${post.id}" onclick="app.toggleLike('${post.id}')" class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg text-gray-600 font-medium transition-colors ${post.isLiked ? 'text-blue-600' : ''}">
                                <i class="far fa-thumbs-up ${post.isLiked ? 'fas' : ''} text-lg"></i> Like
                            </button>
                            <button class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg text-gray-600 font-medium transition-colors">
                                <i class="far fa-comment-alt text-lg"></i> Comment
                            </button>
                            <button class="flex-1 flex items-center justify-center gap-2 py-2 hover:bg-gray-100 rounded-lg text-gray-600 font-medium transition-colors">
                                <i class="fas fa-share text-lg"></i> Share
                            </button>
                        </div>
                    `;
                    container.appendChild(el);
                });
            }

            renderProfile() {
                const user = this.userMap.get(this.state.profileId);
                if (!user) return;

                // Header
                document.getElementById('profile-name').innerText = user.fullName;
                document.getElementById('profile-cover').style.backgroundImage = `url(${user.coverPhoto})`; // Re-seed usually changes image, but good enough for mimic
                // For stable cover in this simple mimic, we used same URL.

                document.getElementById('profile-avatar-large').src = user.avatar;
                document.getElementById('profile-friends-count').innerText = `${user.friendIds.length} Friends`;
                document.getElementById('profile-post-avatar').src = this.currentUser.avatar;

                // Friend preview (bubbles)
                const friendsPreview = document.getElementById('profile-friends-preview');
                friendsPreview.innerHTML = '';
                user.friendIds.slice(0, 8).forEach(fid => {
                    const f = this.userMap.get(fid);
                    const img = document.createElement('img');
                    img.src = f.avatar;
                    img.className = "w-8 h-8 rounded-full border-2 border-white object-cover";
                    friendsPreview.appendChild(img);
                });

                // Intro
                document.getElementById('profile-bio').innerText = user.bio;
                document.getElementById('profile-work').innerText = user.work;
                document.getElementById('profile-school').innerText = user.school;
                document.getElementById('profile-city').innerText = user.city;
                document.getElementById('profile-from').innerText = user.from;
                document.getElementById('profile-relationship').innerText = user.relationship;
                document.getElementById('profile-phone').innerText = user.phone;

                // Friends Grid
                const friendsGrid = document.getElementById('friends-grid');
                document.getElementById('profile-friends-subtext').innerText = `${user.friendIds.length} friends`;
                friendsGrid.innerHTML = '';
                user.friendIds.slice(0, 9).forEach(fid => {
                    const f = this.userMap.get(fid);
                    const div = document.createElement('div');
                    div.className = "cursor-pointer";
                    div.onclick = () => this.navigateToProfile(f.id);
                    div.innerHTML = `
                        <img src="${f.avatar}" class="w-full h-24 object-cover rounded-lg mb-1">
                        <div class="text-xs font-semibold truncate">${f.fullName}</div>
                    `;
                    friendsGrid.appendChild(div);
                });

                // Action Button Logic
                const btn = document.getElementById('btn-add-friend');
                if (user.id === this.currentUser.id) {
                    btn.innerHTML = `<i class="fas fa-pen"></i> <span>Edit Profile</span>`;
                    btn.className = "bg-[#E4E6EB] text-black px-4 py-2 rounded-md font-semibold hover:bg-[#D8DADF] transition-colors flex items-center gap-2";
                } else if (this.currentUser.friendIds.includes(user.id)) {
                    btn.innerHTML = `<i class="fas fa-user-check"></i> <span>Friends</span>`;
                    btn.className = "bg-[#E4E6EB] text-black px-4 py-2 rounded-md font-semibold hover:bg-[#D8DADF] transition-colors flex items-center gap-2";
                } else {
                    btn.innerHTML = `<i class="fas fa-user-plus"></i> <span>Add Friend</span>`;
                    btn.className = "bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2";
                    btn.onclick = () => {
                        this.toggleFriend(user.id);
                        this.renderProfile(); // re-render to show status change
                    };
                }

                // Profile Feed (Random posts attributed to this user)
                // Filter global posts or generate new ones for the profile feel
                const profilePosts = this.state.posts.filter(p => p.authorId === user.id);
                if (profilePosts.length === 0) {
                    // Generate on fly if none
                    const newPost = this.createRandomPost();
                    newPost.authorId = user.id;
                    this.state.posts.unshift(newPost);
                    profilePosts.push(newPost);
                }
                this.renderFeed(profilePosts, 'profile-feed-container');
            }

            // --- Actions & Navigation ---

            navigate(view) {
                this.state.view = view;
                window.scrollTo(0, 0);
                this.renderApp();
            }

            navigateToProfile(id) {
                this.state.profileId = id;
                this.navigate('profile');
            }

            toggleLike(postId) {
                const post = this.state.posts.find(p => p.id === postId);
                if (post) {
                    post.isLiked = !post.isLiked;
                    post.likes += post.isLiked ? 1 : -1;

                    // Update DOM specifically without full re-render for performance
                    const btn = document.getElementById(`like-btn-${postId}`);
                    const count = document.getElementById(`likes-count-${postId}`);

                    if (btn && count) {
                        count.innerText = post.likes;
                        if (post.isLiked) {
                            btn.classList.add('text-blue-600');
                            btn.querySelector('i').classList.remove('far');
                            btn.querySelector('i').classList.add('fas', 'animate-like');
                        } else {
                            btn.classList.remove('text-blue-600');
                            btn.querySelector('i').classList.remove('fas', 'animate-like');
                            btn.querySelector('i').classList.add('far');
                        }
                    }
                }
            }

            toggleFriend(targetId) {
                if (this.currentUser.friendIds.includes(targetId)) {
                    // Unfriend
                    this.currentUser.friendIds = this.currentUser.friendIds.filter(id => id !== targetId);
                    this.showToast("Friend removed");
                } else {
                    // Add friend
                    this.currentUser.friendIds.push(targetId);
                    this.showToast("Friend request sent!");
                }
            }

            showToast(msg) {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                t.classList.remove('translate-y-20');
                setTimeout(() => {
                    t.classList.add('translate-y-20');
                }, 3000);
            }
        }

        // Start App
        const app = new App();
        window.onload = () => app.init();
        window.app = app; // Expose for onclick handlers

    </script>
</body>

</html>